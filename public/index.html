<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>LeakWatch üîç</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="grid-overlay"></div>

  <div class="container">
    <header>
      <div class="logo">
        <span style="font-size:2.5rem">üîç</span>
        <h1>LeakWatch</h1>
      </div>
      <p class="subtitle">// Secret credential scanner for GitHub repos //</p>
    </header>

    <div class="scanner-box">
      <div class="input-group">
        <input type="text" id="owner" placeholder="Usuario u organizaci√≥n" />
        <input type="text" id="repo" placeholder="Repositorio" />
        <button id="scanBtn" onclick="startScan()">‚ö° Scan</button>
      </div>
    </div>

    <div id="status" class="status hidden">
      <div class="scanning-line"></div>
      <span id="statusText">Escaneando...</span>
    </div>

    <div id="results" class="results hidden">
      <h2>// Resultados <span id="totalBadge" class="badge"></span></h2>
      <div id="findings"></div>
    </div>
  </div>

  <div class="signature">By Astra</div>

  <script>
    async function startScan() {
      const owner = document.getElementById("owner").value.trim();
      const repo = document.getElementById("repo").value.trim();
      const status = document.getElementById("status");
      const statusText = document.getElementById("statusText");
      const results = document.getElementById("results");
      const findings = document.getElementById("findings");
      const btn = document.getElementById("scanBtn");

      if (!owner || !repo) {
        alert("Por favor ingresa usuario y repositorio");
        return;
      }

      btn.disabled = true;
      btn.textContent = "‚è≥ Scanning...";
      status.className = "status";
      statusText.textContent = `Escaneando ${owner}/${repo}...`;
      results.className = "results hidden";

      try {
        const res = await fetch("/scan", {
          method: "POST",
          headers: { "Content-Type": "application/json" },
          body: JSON.stringify({ owner, repo }),
        });

        const data = await res.json();
        document.getElementById("totalBadge").textContent = data.total;
        findings.innerHTML = "";

        if (data.total === 0) {
          findings.innerHTML = `<div class="no-findings">‚úÖ &nbsp; No se encontraron credenciales expuestas</div>`;
        } else {
          data.findings.forEach((f) => {
            findings.innerHTML += `
              <div class="finding-card">
                <div class="finding-type">‚ö†Ô∏è &nbsp;${f.type}</div>
                <div class="finding-file">üìÑ &nbsp;${f.file}</div>
                <a href="${f.url}" target="_blank" class="finding-link">‚Üí Ver en GitHub</a>
              </div>`;
          });
        }

        results.className = "results";
        status.className = "status hidden";

      } catch (err) {
        statusText.textContent = "‚ùå Error al escanear. Verifica el repositorio.";
      } finally {
        btn.disabled = false;
        btn.textContent = "‚ö° Scan";
      }
    }
  </script>
</body>
</html>